<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vertical Line Charts</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        .chart-container {
            width: 100%;
            height: 100%;
            margin: 20px 0;
        }

        canvas {
            max-width: 100%;
            max-height: 100%;
        }
    </style>
</head>
<body>
<div class="chart-container">
    <canvas id="chart1"></canvas>
</div>
<div class="chart-container">
    <canvas id="chart2"></canvas>
</div>
<div class="chart-container">
    <canvas id="chart3"></canvas>
</div>
<div class="chart-container">
    <canvas id="chart4"></canvas>
</div>

<script>
    // Create chart configurations
    function createChart(ctx, label, color) {
        return new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: label,
                    data: [],
                    borderColor: color,
                    backgroundColor: color,
                    fill: false,
                    tension: 0.4,
                }]
            },
            options: {
                animation: false,
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {title: {display: true, text: 'Time'}},
                    y: {
                        title: {display: true, text: 'Values'},
                        // min: 0.0, // Set minimum Y value
                        // max: maxY, // Set maximum Y value
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            usePointStyle: true,
                            boxWidth: 20,
                            boxHeight: 20,
                        },
                    },
                },
            }
        });
    }

    // Initialize all charts
    const chart1 = createChart(document.getElementById('chart1').getContext('2d'), 'Smell', 'red');
    const chart2 = createChart(document.getElementById('chart2').getContext('2d'), 'Temperature (C)', 'blue');
    const chart3 = createChart(document.getElementById('chart3').getContext('2d'), 'Pressure (milBAR)', 'green');
    const chart4 = createChart(document.getElementById('chart4').getContext('2d'), 'Humidity (%)', 'purple');

    // Update function for all charts
    function updateChart(chart, data) {
        const timestamp = new Date().toLocaleTimeString();
        chart.data.labels.push(timestamp);
        chart.data.datasets[0].data.push(data);

        // Keep the last 20 points
        if (chart.data.labels.length > 20) {
            chart.data.labels.shift();
            chart.data.datasets[0].data.shift();
        }

        chart.update();
    }

    // Connect to the WebSocket
    const socket = io('http://127.0.0.1:5000');

    // Listen for `update_chart` events
    socket.on('update_chart', (msg) => {
        if (msg.data) {
            updateChart(chart1, msg.data[0]);
            updateChart(chart2, msg.data[1]);
            updateChart(chart3, msg.data[2]);
            updateChart(chart4, msg.data[3]);
        }
    });
</script>
</body>
</html>
